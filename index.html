<!DOCTYPE html>
<html lang="pt-BR" x-data="app()" x-init="init()" :class="userSettings.theme || 'theme-dark'">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeX-Tron - Controle de Investimentos</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <link rel="stylesheet" href="style.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Roboto Mono', 'monospace'],
                    },
                    colors: {
                        'brand-cyan': 'var(--color-brand-cyan)',
                        'brand-blue': 'var(--color-brand-blue)',
                        'brand-orange': 'var(--color-brand-orange)',
                        'brand-green': 'var(--color-brand-green)',
                        'brand-purple': 'var(--color-brand-purple)',
                        'brand-yellow': 'var(--color-brand-yellow)',
                        'bg-sidebar': 'var(--color-bg-sidebar)',
                        'bg-card': 'var(--color-bg-card)',
                        'bg-ui': 'var(--color-bg-ui)',
                        'border-color': 'var(--color-border)',
                        'text-primary': 'var(--color-text-primary)',
                        'text-secondary': 'var(--color-text-secondary)',
                    }
                }
            }
        }
    </script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // Configuração Firebase REAL
        const firebaseConfig = {
            apiKey: "AIzaSyD5NSW9h5aE_OcK_g0trfrOwPjLUvjkjVw",
  	    authDomain: "acompanhamento-de-ativos.firebaseapp.com",
  	    projectId: "acompanhamento-de-ativos",
	    storageBucket: "acompanhamento-de-ativos.firebasestorage.app",
	    messagingSenderId: "61333992547",
	    appId: "1:61333992547:web:de833a02c39612cbfe3456",
	    measurementId: "G-KV78DS73WC"
        };

        // Inicialização direta SEM fallback/manual
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

</head>

<body x-cloak>

    <div x-show="!isLoggedIn" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-[100]" x-cloak>
        <div class="bg-bg-card border border-border-color rounded-2xl p-8 shadow-2xl text-center w-full max-w-sm m-4">
            <div class="mx-auto mb-4 w-16 h-16 flex items-center justify-center p-1 rounded-lg shadow-sm logo-bg">
                <img src="https://i.imgur.com/oYxNpaq.png" alt="Logo DeX-Tron" class="w-full h-full object-contain logo-glow" onerror="this.onerror=null;this.src='https://placehold.co/32x32/e9ecef/1d1d1f?text=D';">
            </div>
            <h2 class="text-2xl font-bold text-text-primary mb-2">Bem-vindo ao DeX-Tron</h2>
            <p class="text-text-secondary mb-6">Digite seu nome de usuário para carregar ou criar sua carteira.</p>
            <form @submit.prevent="login()">
                <input type="text" x-model="loginUsername" placeholder="Ex: Bruno" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary text-center mb-4">
                <button type="submit" class="w-full bg-brand-cyan text-white dark:text-bg-sidebar font-semibold p-3 rounded-lg shadow-sm hover:opacity-90 transition-opacity">Entrar</button>
            </form>
        </div>
    </div>

    <div x-show="showToast" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-2" x-transition:enter-end="opacity-100 transform translate-y-0" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 transform translate-y-0" x-transition:leave-end="opacity-0 transform translate-y-2" class="fixed top-5 right-5 bg-bg-card border border-brand-cyan text-text-primary text-sm font-semibold px-4 py-3 rounded-lg shadow-lg z-50 toast" x-text="toastMessage" x-cloak>
    </div>

    <div class="flex min-h-screen" x-show="isLoggedIn" x-cloak>

        <aside class="flex-shrink-0 bg-bg-sidebar border-r border-border-color flex flex-col transition-all duration-300" :class="isSidebarCollapsed ? 'w-20' : 'w-64'">
            <div class="p-4 flex items-center space-x-3 border-b border-border-color h-16 overflow-hidden">
                <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center p-1 rounded-lg shadow-sm logo-bg">
                    <img src="https://i.imgur.com/oYxNpaq.png" alt="Logo DeX-Tron" class="w-full h-full object-contain logo-glow" onerror="this.onerror=null;this.src='https://placehold.co/32x32/e9ecef/1d1d1f?text=D';">
                </div>
                <div class="transition-all duration-300" :class="isSidebarCollapsed ? 'opacity-0 -translate-x-4' : ''">
                    <h1 class="text-lg font-bold text-text-primary whitespace-nowrap">DeX-Tron</h1>
                </div>
            </div>

            <nav class="flex-grow p-4 space-y-2">
                <template x-for="item in menuItems" :key="item.tab">
                    <button @click="mainTab = item.tab" :class="mainTab === item.tab ? 'text-brand-cyan font-semibold border-brand-cyan' : 'text-text-secondary border-transparent'" class="w-full flex items-center py-2.5 rounded-lg transition-colors duration-200 text-sm border-l-2 hover:text-text-primary" :title="isSidebarCollapsed ? item.label : ''" :class="isSidebarCollapsed ? 'justify-center px-0' : 'justify-start px-3'">
                        <div x-html="item.icon"></div>
                        <span class="ml-3 whitespace-nowrap transition-opacity duration-200" :class="isSidebarCollapsed ? 'opacity-0' : 'opacity-100'" x-text="item.label"></span>
                    </button>
                </template>
                <button @click="isSidebarCollapsed = !isSidebarCollapsed" class="w-full flex items-center justify-center py-2.5 rounded-lg text-text-secondary hover:text-text-primary hover:bg-bg-ui transition-colors duration-200">
                    <svg x-show="!isSidebarCollapsed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <rect width="18" height="18" x="3" y="3" rx="2" />
                        <path d="M9 3v18" />
                    </svg>
                    <svg x-show="isSidebarCollapsed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <rect width="18" height="18" x="3" y="3" rx="2" />
                        <path d="M9 3v18" />
                        <path d="M15 3v18" />
                    </svg>
                </button>
            </nav>

            <div class="p-4 mt-auto">
                <button @click="mainTab = 'config'" class="w-full bg-gradient-to-r from-blue-800 to-purple-800 text-white font-semibold py-2.5 px-4 rounded-lg transition-opacity text-sm flex items-center justify-center gap-2">
                    <span class="whitespace-nowrap transition-opacity duration-200" :class="isSidebarCollapsed ? 'opacity-100' : 'opacity-100'" x-text="isSidebarCollapsed ? userSettings.username.substring(0, 2).toUpperCase() : userSettings.username">
                    </span>
                </button>
            </div>
        </aside>

        <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">
            <div x-show="!isDataLoaded" class="flex justify-center items-center h-full" x-cloak>
                <div class="w-12 h-12 border-4 border-brand-cyan border-t-transparent rounded-full animate-spin"></div>
            </div>

            <div x-show="isDataLoaded" x-cloak>
                <div class="flex justify-between items-center mb-6 gap-4">
    <div class="flex-1">
        <h2 class="text-2xl font-bold text-text-primary" x-text="pageTitle"></h2>
        <p class="text-sm text-text-secondary" x-text="mainTab === 'resumo' ? `Última atualização: ${lastUpdated}` : 'Gerencie seus ativos e transações'"></p>
    </div>

    <div class="flex items-center gap-2">
        <button @click="showUndoConfirmation = true" x-show="history.length > 0" class="flex items-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg bg-bg-ui border border-border-color text-text-secondary hover:text-text-primary hover:border-brand-yellow transition-colors">
            <i data-lucide="undo-2" class="w-4 h-4"></i>
            <span>Desfazer</span>
        </button>

        <button @click="manualRefresh()" :disabled="isUpdatingPrices" class="flex items-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg bg-bg-ui border border-border-color text-text-secondary hover:text-text-primary hover:border-brand-cyan transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            <i data-lucide="refresh-cw" class="w-4 h-4" :class="{'animate-spin': isUpdatingPrices}"></i>
            <span>Atualizar</span>
        </button>

        <button @click="showCalculatorModal = true" class="flex items-center gap-2 px-3 py-2 text-sm font-semibold rounded-lg bg-bg-ui border border-border-color text-text-secondary hover:text-text-primary hover:border-brand-purple transition-colors">
            <i data-lucide="calculator" class="w-4 h-4"></i>
            <span>Calculadora</span>
        </button>
    </div>
</div>

                <div x-show="mainTab === 'resumo'">
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <div class="flex-grow"></div>
                        <div class="flex items-center gap-2">
                            <label for="summary-sort" class="text-sm font-medium text-text-secondary">Organizar por:</label>
                            <select id="summary-sort" x-model="summarySortCriteria" class="form-select bg-bg-ui border-border-color text-text-primary rounded-lg p-2 text-sm">
                                <option value="valorizacao">Maior Valorização</option>
                                <option value="desvalorizacao">Maior Desvalorização</option>
                                <option value="variacao">Maior Variação</option>
                            </select>
                        </div>
                    </div>
                    <div class="bg-bg-card p-6 rounded-2xl border border-border-color shadow-lg mb-8">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm text-text-secondary mb-1">Patrimônio Total</p>
                                <p class="text-4xl font-bold text-text-primary" x-text="formatCurrency(totalPortfolioValueUSD)"></p>
                                <p class="text-sm font-semibold mt-1" :class="totalDailyPL >= 0 ? 'text-brand-green' : 'text-brand-orange'" x-text="`${totalDailyPL >= 0 ? '+' : ''}${formatCurrency(totalDailyPL)} (${totalDailyPLPercent.toFixed(2)}%) hoje`"></p>
                            </div>
                            <button @click="manualRefresh()" class="text-text-secondary hover:text-text-primary p-2 rounded-full hover:bg-bg-ui transition-colors" :disabled="isUpdatingPrices">
                                <svg class="w-6 h-6" :class="{'animate-spin': isUpdatingPrices}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        <template x-if="sortedAssets.length === 0">
                            <div class="md:col-span-2 lg:col-span-3 xl:col-span-4 text-center p-12 text-text-secondary bg-bg-card rounded-2xl border border-border-color">
                                Você ainda não possui ativos na carteira.
                            </div>
                        </template>
                        <template x-for="(asset, index) in sortedAssets" :key="asset.ticker">
                            <div class="bg-bg-card p-5 rounded-2xl border border-border-color shadow-lg flex justify-between items-center">
                                <div>
                                    <p class="font-bold text-text-primary" x-text="asset.ticker"></p>
                                    <p class="text-xs text-text-secondary -mt-1 truncate max-w-[150px]" x-text="asset.name"></p>
                                    <p class="text-2xl font-bold text-text-primary mt-2" x-text="formatCurrency(asset.currentPrice)"></p>
                                </div>
                                <div class="text-right">
                                    <div x-html="getSummaryCardIcon(asset.dailyChangePercent)"></div>
                                    <p class="text-sm font-semibold mt-2" :class="getSummaryPlColorClass(asset.dailyChangePercent)" x-text="`${asset.dailyChangePercent.toFixed(2)}%`"></p>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <div x-show="mainTab === 'portfolio'">
                    <div class="bg-bg-card p-6 rounded-2xl border border-border-color shadow-lg mb-8">
                        <h2 class="text-xl font-semibold mb-5 text-text-primary">Registrar Transação</h2>
                        <div class="mb-5">
                            <label class="block text-sm font-medium text-text-secondary mb-2">Tipo de Transação</label>
                            <div id="transaction-type" class="flex flex-wrap gap-2">
                                <div class="relative"><input type="radio" id="type-buy" value="buy" class="sr-only peer" x-model="txType"><label for="type-buy" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-blue peer-checked:border-brand-blue">Compra</label></div>
                                <div class="relative"><input type="radio" id="type-sell" value="sell" class="sr-only peer" x-model="txType"><label for="type-sell" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-orange peer-checked:border-brand-orange">Venda</label></div>
                                <div class="relative"><input type="radio" id="type-dividend" value="dividend" class="sr-only peer" x-model="txType"><label for="type-dividend" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-green peer-checked:border-brand-green">Dividendos</label></div>
                                <div class="relative"><input type="radio" id="type-update" value="update" class="sr-only peer" x-model="txType"><label for="type-update" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-purple peer-checked:border-brand-purple">Atualizar Posição</label></div>
                                <div class="relative"><input type="radio" id="type-crypto" value="crypto" class="sr-only peer" x-model="txType"><label for="type-crypto" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-yellow peer-checked:border-brand-yellow">Cripto</label></div>
                            </div>
                        </div>

                        <form @submit.prevent="registerTransaction" x-show="txType === 'buy' || txType === 'sell' || txType === 'dividend'">
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div class="sm:col-span-3 relative"><label for="asset-name" class="block text-sm font-medium text-text-secondary mb-1">Nome do Ativo</label><input type="text" id="asset-name" placeholder="Ex: Apple Inc." class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model="newTx.name"></div>
                                <div class="relative"><label for="asset-ticker" class="block text-sm font-medium text-text-secondary mb-1">Ticker</label><input type="text" id="asset-ticker" placeholder="Ex: AAPL" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model="newTx.ticker" @blur="fetchAndFillInfo('newTx')">
                                    <div x-show="isFetchingInfo.newTx" class="absolute inset-y-0 right-0 flex items-center pr-3">
                                        <div class="w-5 h-5 border-2 border-text-secondary border-t-transparent rounded-full animate-spin"></div>
                                    </div>
                                </div>
                                <div x-show="txType === 'buy'"><label for="asset-quantity" class="block text-sm font-medium text-text-secondary mb-1">Quantidade</label><input type="number" step="any" id="asset-quantity" placeholder="10" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model.number="newTx.qty"></div>
                                <div x-show="txType === 'sell'"><label for="asset-sell-value" class="block text-sm font-medium text-text-secondary mb-1">Valor da Venda ($)</label><input type="number" step="any" id="asset-sell-value" placeholder="1500.00" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model.number="newTx.sellValue"></div>
                                <div x-show="txType !== 'dividend'"><label for="asset-price" class="block text-sm font-medium text-text-secondary mb-1">Preço ($)</label><input type="number" id="asset-price" placeholder="150.75" step="any" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model.number="newTx.price"></div>
                                <div x-show="txType === 'dividend'"><label for="asset-price-dividend" class="block text-sm font-medium text-text-secondary mb-1">Valor Total ($)</label><input type="number" id="asset-price-dividend" placeholder="100.00" step="any" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model.number="newTx.price"></div>
                                <div x-show="txType === 'dividend'"><label for="asset-net-dividend" class="block text-sm font-medium text-text-secondary mb-1">Valor Líquido (após 30% imposto)</label><input type="text" id="asset-net-dividend" placeholder="70.00" disabled class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color disabled:opacity-70 cursor-not-allowed text-text-primary" :value="newTx.price ? (newTx.price * 0.70).toFixed(2) : ''"></div>
                                <div x-show="txType === 'dividend'" class="sm:col-span-3">
                                    <label for="reinvest-dividend" class="flex items-center space-x-3 cursor-pointer text-sm text-text-secondary hover:text-text-primary transition-colors">
                                        <input type="checkbox" id="reinvest-dividend" x-model="newTx.reinvest" class="form-checkbox h-4 w-4 rounded bg-bg-ui border-border-color text-brand-green focus:ring-brand-green focus:ring-offset-bg-card">
                                        <span>Reinvestir Dividendo Líquido (compra o ativo com o valor líquido ao preço atual)</span>
                                    </label>
                                </div>
                                <div class="sm:col-span-3 flex items-end">
                                    <button type="submit" class="w-full text-white font-semibold p-3 rounded-lg shadow-sm hover:opacity-90 transition-colors" :class="{ 'bg-brand-blue': txType === 'buy', 'bg-brand-orange': txType === 'sell', 'bg-brand-green': txType === 'dividend' }">Registrar</button>
                                </div>
                            </div>
                        </form>
                        <form @submit.prevent="updatePortfolioAsset" x-show="txType === 'update'">
                            <p class="text-sm text-text-secondary mb-4 -mt-2">Use esta seção para adicionar ativos que você já possui ou para corrigir a posição de um ativo existente.</p>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div class="sm:col-span-2 lg:col-span-4"><label for="update-asset-name" class="block text-sm font-medium text-text-secondary mb-1">Nome do Ativo (Opcional)</label><input type="text" id="update-asset-name" placeholder="Ex: Apple Inc." class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model="updateAsset.name"></div>
                                <div class="relative"><label for="update-asset-ticker" class="block text-sm font-medium text-text-secondary mb-1">Ticker</label><input type="text" id="update-asset-ticker" placeholder="Ex: AAPL" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model="updateAsset.ticker" @blur="fetchAndFillInfo('updateAsset')">
                                    <div x-show="isFetchingInfo.updateAsset" class="absolute inset-y-0 right-0 flex items-center pr-3">
                                        <div class="w-5 h-5 border-2 border-text-secondary border-t-transparent rounded-full animate-spin"></div>
                                    </div>
                                </div>
                                <div><label for="update-asset-quantity" class="block text-sm font-medium text-text-secondary mb-1">Quantidade Total</label><input type="number" step="any" id="update-asset-quantity" placeholder="100" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model.number="updateAsset.qty"></div>
                                <div><label for="update-asset-avg-price" class="block text-sm font-medium text-text-secondary mb-1" x-text="`Preço Médio (${userSettings.currency === 'BRL' ? 'R$' : '$'})`"></label><input type="number" id="update-asset-avg-price" placeholder="150.75" step="any" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary" x-model.number="updateAsset.avgPrice"></div>
                                <div>
                                    <label for="update-asset-type" class="block text-sm font-medium text-text-secondary mb-1">Tipo</label>
                                    <select id="update-asset-type" x-model="updateAsset.type" class="form-select w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                                        <option value="Ação">Ação</option>
                                        <option value="ETF">ETF</option>
                                        <option value="REIT">REIT</option>
                                        <option value="Outro">Outro</option>
                                    </select>
                                </div>
                                <div class="sm:col-span-2 lg:col-span-4 flex items-end"><button type="submit" class="w-full bg-brand-purple text-white font-semibold p-3 rounded-lg shadow-sm hover:opacity-90 transition-opacity">Registrar</button></div>
                            </div>
                        </form>
                        <form @submit.prevent="registerCrypto" x-show="txType === 'crypto'">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="crypto-wallet" class="block text-sm font-medium text-text-secondary mb-1">Cold Wallet</label>
                                    <select id="crypto-wallet" x-model="newCryptoTx.coldwallet" class="form-select w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                                        <template x-for="wallet in coldWalletList" :key="wallet">
                                            <option :value="wallet" x-text="wallet"></option>
                                        </template>
                                    </select>
                                </div>
                                <div x-show="newCryptoTx.coldwallet === 'Outra'">
                                    <label for="crypto-custom-wallet" class="block text-sm font-medium text-text-secondary mb-1">Nome da Wallet</label>
                                    <input type="text" id="crypto-custom-wallet" placeholder="Ex: CoolWallet" x-model="newCryptoTx.customWallet" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="crypto-coin" class="block text-sm font-medium text-text-secondary mb-1">Moeda</label>
                                    <select id="crypto-coin" x-model="newCryptoTx.coin" @change="fetchAndFillInfo('crypto')" class="form-select w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                                        <template x-for="crypto in cryptoList" :key="crypto.ticker">
                                            <option :value="crypto.ticker" x-text="crypto.name"></option>
                                        </template>
                                    </select>
                                </div>
                                <div x-show="newCryptoTx.coin === 'OTHER'">
                                    <label for="crypto-custom" class="block text-sm font-medium text-text-secondary mb-1">Nome da Moeda</label>
                                    <input type="text" id="crypto-custom" placeholder="Ex: MyCoin" x-model="newCryptoTx.customCoin" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                                </div>
                                <div>
                                    <label for="crypto-qty" class="block text-sm font-medium text-text-secondary mb-1">Quantidade</label>
                                    <input type="number" step="any" id="crypto-qty" placeholder="0.5" x-model.number="newCryptoTx.qty" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                                </div>
                                <div class="relative">
                                    <label for="crypto-price" class="block text-sm font-medium text-text-secondary mb-1" x-text="`Preço da Moeda (${userSettings.currency === 'BRL' ? 'R$' : '$'})`"></label>
                                    <input type="number" step="any" id="crypto-price" placeholder="60000.00" x-model.number="newCryptoTx.coinPrice" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                                    <div x-show="isFetchingInfo.crypto" class="absolute inset-y-0 right-0 flex items-center pr-3 pt-6">
                                        <div class="w-5 h-5 border-2 border-text-secondary border-t-transparent rounded-full animate-spin"></div>
                                    </div>
                                </div>
                                <div>
                                    <label for="crypto-total" class="block text-sm font-medium text-text-secondary mb-1" x-text="`Valor Total (${userSettings.currency === 'BRL' ? 'R$' : '$'})`"></label>
                                    <input type="number" step="any" id="crypto-total" placeholder="30000.00" x-model.number="newCryptoTx.totalValue" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                                </div>
                                <div class="md:col-span-3 flex items-end">
                                    <button type="submit" class="w-full bg-brand-yellow text-white font-semibold p-3 rounded-lg shadow-sm hover:opacity-90 transition-opacity">Registrar</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="mb-6">
                        <nav id="portfolio-subtabs" class="flex space-x-6 border-b border-border-color">
                            <button @click="portfolioSubTab = 'portfolio'" :class="{'active': portfolioSubTab === 'portfolio'}" class="sub-portfolio-tab py-3 px-1 text-sm font-medium text-text-secondary border-b-2 border-transparent hover:text-brand-cyan transition-colors">Carteira</button>
                            <button @click="portfolioSubTab = 'crypto_assets'" :class="{'active': portfolioSubTab === 'crypto_assets'}" class="sub-portfolio-tab py-3 px-1 text-sm font-medium text-text-secondary border-b-2 border-transparent hover:text-brand-cyan transition-colors">Criptoativos</button>
                            <button @click="portfolioSubTab = 'profit-loss'" :class="{'active': portfolioSubTab === 'profit-loss'}" class="sub-portfolio-tab py-3 px-1 text-sm font-medium text-text-secondary border-b-2 border-transparent hover:text-brand-cyan transition-colors">Lucro/Prejuízo</button>
                            <button @click="portfolioSubTab = 'dividends'" :class="{'active': portfolioSubTab === 'dividends'}" class="sub-portfolio-tab py-3 px-1 text-sm font-medium text-text-secondary border-b-2 border-transparent hover:text-brand-cyan transition-colors">Dividendos</button>
                        </nav>
                    </div>

                    <div id="portfolio-tabs-content">
                        <div x-show="portfolioSubTab === 'portfolio'">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-semibold text-text-primary">Minha Carteira</h2>
                                <div class="flex gap-3">
                                    <button @click="openAlertModal()" class="btn-secondary bg-bg-ui text-text-primary hover:bg-border-color font-semibold py-2 px-4 rounded-lg text-sm flex items-center gap-2 transition-colors">
   					 <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-brand-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   					     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
  				         </svg>
   						 Alerta de Venda
				     </button>
                                    <button @click="analyzePortfolio" class="btn-secondary bg-bg-ui text-text-primary hover:bg-border-color font-semibold py-2 px-4 rounded-lg text-sm flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-brand-cyan">
                                            <path d="M12 2 L15.09 8.91 L22 12 L15.09 15.09 L12 22 L8.91 15.09 L2 12 L8.91 8.91 L12 2 Z" />
                                        </svg> Analisar com IA</button><button class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors text-sm">Exportar CSV</button>
                                </div>
                            </div>
                           <div x-show="etfAssets.length > 0" class="mb-8">
    <h3 class="text-lg font-medium text-text-secondary mb-3">ETFs</h3>
    <div class="bg-bg-card rounded-2xl border border-border-color shadow-lg overflow-hidden">
        <table class="w-full text-left">
            <thead class="border-b border-border-color text-sm">
                <tr class="text-left">
                    <th class="p-4 font-semibold text-text-secondary">TICKER</th>
                    <th class="p-4 font-semibold text-text-secondary">TIPO</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">QTD.</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">PREÇO MÉDIO</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">PREÇO ATUAL</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">
                        <div class="flex items-center justify-end gap-1"><span>PATRIMÔNIO</span><button @click.stop="showInfoPopup('Cálculo do Patrimônio', 'O patrimônio é calculado multiplicando a Quantidade de cotas que você possui pelo Preço Atual do ativo.')"><i data-lucide="help-circle" class="w-4 h-4 text-text-secondary hover:text-text-primary"></i></button></div>
                    </th>
                    <th class="p-4 font-semibold text-text-secondary text-center">VARIAÇÃO (%)</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">
                        <div class="flex items-center justify-end gap-1"><span>RENDIMENTO</span><button @click.stop="showInfoPopup('Cálculo do Rendimento', 'O rendimento total combina o lucro/prejuízo não realizado (Variação da cota x Quantidade) com todos os dividendos e lucros de vendas já realizados para este ativo.')"><i data-lucide="help-circle" class="w-4 h-4 text-text-secondary hover:text-text-primary"></i></button></div>
                    </th>
                    <th class="p-4 font-semibold text-text-secondary text-center">AÇÕES</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="asset in etfAssets" :key="asset.ticker">
                    <tr class="border-t border-border-color text-sm text-text-primary transition-colors" :class="{'flash-update': asset.justUpdated}">
                        <td class="p-4 font-medium flex items-center gap-3">
                            <span x-show="isAlertTriggered(asset)" :class="getAlertIconStatus(asset)" @click="onClickAssetAlertIcon(asset.ticker)" x-html="getIcon(parseFloat(getVariationPercent(asset.currentPrice, asset.avgPrice)))" class="cursor-pointer">
                            </span>
                            <span x-text="asset.ticker"></span>
                        </td>
                        <td class="p-4 text-center"><i data-lucide="wallet-cards" class="w-5 h-5 text-text-secondary mx-auto"></i></td>
                        <td class="p-4 text-right" x-text="asset.qty.toFixed(2)"></td>
                        <td class="p-4 text-right" x-text="formatCurrency(asset.avgPrice)"></td>
                        <td class="p-4 text-right" x-text="formatCurrency(asset.currentPrice)"></td>
                        <td class="p-4 text-right font-semibold" x-text="formatCurrency(asset.qty * asset.currentPrice)"></td>
                        <td class="p-4 text-center">
                            <div class="flex items-center justify-center gap-2"><span x-html="getIcon(parseFloat(getVariationPercent(asset.currentPrice, asset.avgPrice)))"></span><span x-text="`${getVariationPercent(asset.currentPrice, asset.avgPrice)}%`"></span></div>
                        </td>
                        <td class="p-4 text-right font-medium" :class="getPlColorClass(getAssetYield(asset))" x-text="formatCurrency(getAssetYield(asset))"></td>
                        <td class="p-4 text-center"><button @click="confirmDelete(asset.ticker)" class="p-1 text-text-secondary hover:text-red-600 transition-colors rounded-md"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</div>
                            <div x-show="reitAssets.length > 0" class="mb-8">
    <h3 class="text-lg font-medium text-text-secondary mb-3">REITs</h3>
    <div class="bg-bg-card rounded-2xl border border-border-color shadow-lg overflow-hidden">
        <table class="w-full text-left">
            <thead class="border-b border-border-color text-sm">
                <tr class="text-left">
                    <th class="p-4 font-semibold text-text-secondary">TICKER</th>
                    <th class="p-4 font-semibold text-text-secondary">TIPO</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">QTD.</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">PREÇO MÉDIO</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">PREÇO ATUAL</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">
                        <div class="flex items-center justify-end gap-1"><span>PATRIMÔNIO</span><button @click.stop="showInfoPopup('Cálculo do Patrimônio', 'O patrimônio é calculado multiplicando a Quantidade de cotas que você possui pelo Preço Atual do ativo.')"><i data-lucide="help-circle" class="w-4 h-4 text-text-secondary hover:text-text-primary"></i></button></div>
                    </th>
                    <th class="p-4 font-semibold text-text-secondary text-center">VARIAÇÃO (%)</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">
                        <div class="flex items-center justify-end gap-1"><span>RENDIMENTO</span><button @click.stop="showInfoPopup('Cálculo do Rendimento', 'O rendimento total combina o lucro/prejuízo não realizado (Variação da cota x Quantidade) com todos os dividendos e lucros de vendas já realizados para este ativo.')"><i data-lucide="help-circle" class="w-4 h-4 text-text-secondary hover:text-text-primary"></i></button></div>
                    </th>
                    <th class="p-4 font-semibold text-text-secondary text-center">AÇÕES</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="asset in reitAssets" :key="asset.ticker">
                    <tr class="border-t border-border-color text-sm text-text-primary transition-colors" :class="{'flash-update': asset.justUpdated}">
                        <td class="p-4 font-medium flex items-center gap-3">
                            <span x-show="isAlertTriggered(asset)" :class="getAlertIconStatus(asset)" @click="onClickAssetAlertIcon(asset.ticker)" x-html="getIcon(parseFloat(getVariationPercent(asset.currentPrice, asset.avgPrice)))" class="cursor-pointer">
                            </span>
                            <span x-text="asset.ticker"></span>
                        </td>
                        <td class="p-4 text-center"><i data-lucide="building-2" class="w-5 h-5 text-text-secondary mx-auto"></i></td>
                        <td class="p-4 text-right" x-text="asset.qty.toFixed(2)"></td>
                        <td class="p-4 text-right" x-text="formatCurrency(asset.avgPrice)"></td>
                        <td class="p-4 text-right" x-text="formatCurrency(asset.currentPrice)"></td>
                        <td class="p-4 text-right font-semibold" x-text="formatCurrency(asset.qty * asset.currentPrice)"></td>
                        <td class="p-4 text-center">
                            <div class="flex items-center justify-center gap-2"><span x-html="getIcon(parseFloat(getVariationPercent(asset.currentPrice, asset.avgPrice)))"></span><span x-text="`${getVariationPercent(asset.currentPrice, asset.avgPrice)}%`"></span></div>
                        </td>
                        <td class="p-4 text-right font-medium" :class="getPlColorClass(getAssetYield(asset))" x-text="formatCurrency(getAssetYield(asset))"></td>
                        <td class="p-4 text-center"><button @click="confirmDelete(asset.ticker)" class="p-1 text-text-secondary hover:text-red-600 transition-colors rounded-md"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</div>
                           <div x-show="otherAssets.length > 0">
    <h3 class="text-lg font-medium text-text-secondary mb-3">Outros Ativos</h3>
    <div class="bg-bg-card rounded-2xl border border-border-color shadow-lg overflow-hidden">
        <table class="w-full text-left">
            <thead class="border-b border-border-color text-sm">
                <tr class="text-left">
                    <th class="p-4 font-semibold text-text-secondary">TICKER</th>
                    <th class="p-4 font-semibold text-text-secondary">TIPO</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">QTD.</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">PREÇO MÉDIO</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">PREÇO ATUAL</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">
                        <div class="flex items-center justify-end gap-1"><span>PATRIMÔNIO</span><button @click.stop="showInfoPopup('Cálculo do Patrimônio', 'O patrimônio é calculado multiplicando a Quantidade de cotas que você possui pelo Preço Atual do ativo.')"><i data-lucide="help-circle" class="w-4 h-4 text-text-secondary hover:text-text-primary"></i></button></div>
                    </th>
                    <th class="p-4 font-semibold text-text-secondary text-center">VARIAÇÃO (%)</th>
                    <th class="p-4 font-semibold text-text-secondary text-right">
                        <div class="flex items-center justify-end gap-1"><span>RENDIMENTO</span><button @click.stop="showInfoPopup('Cálculo do Rendimento', 'O rendimento total combina o lucro/prejuízo não realizado (Variação da cota x Quantidade) com todos os dividendos e lucros de vendas já realizados para este ativo.')"><i data-lucide="help-circle" class="w-4 h-4 text-text-secondary hover:text-text-primary"></i></button></div>
                    </th>
                    <th class="p-4 font-semibold text-text-secondary text-center">AÇÕES</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="asset in otherAssets" :key="asset.ticker">
                    <tr class="border-t border-border-color text-sm text-text-primary transition-colors" :class="{'flash-update': asset.justUpdated}">
                        <td class="p-4 font-medium flex items-center gap-3">
                            <span x-show="isAlertTriggered(asset)" :class="getAlertIconStatus(asset)" @click="onClickAssetAlertIcon(asset.ticker)" x-html="getIcon(parseFloat(getVariationPercent(asset.currentPrice, asset.avgPrice)))" class="cursor-pointer">
                            </span>
                            <span x-text="asset.ticker"></span>
                        </td>
                        <td class="p-4 text-center"><i data-lucide="gem" class="w-5 h-5 text-text-secondary mx-auto"></i></td>
                        <td class="p-4 text-right" x-text="asset.qty.toFixed(2)"></td>
                        <td class="p-4 text-right" x-text="formatCurrency(asset.avgPrice)"></td>
                        <td class="p-4 text-right" x-text="formatCurrency(asset.currentPrice)"></td>
                        <td class="p-4 text-right font-semibold" x-text="formatCurrency(asset.qty * asset.currentPrice)"></td>
                        <td class="p-4 text-center">
                            <div class="flex items-center justify-center gap-2"><span x-html="getIcon(parseFloat(getVariationPercent(asset.currentPrice, asset.avgPrice)))"></span><span x-text="`${getVariationPercent(asset.currentPrice, asset.avgPrice)}%`"></span></div>
                        </td>
                        <td class="p-4 text-right font-medium" :class="getPlColorClass(getAssetYield(asset))" x-text="formatCurrency(getAssetYield(asset))"></td>
                        <td class="p-4 text-center"><button @click="confirmDelete(asset.ticker)" class="p-1 text-text-secondary hover:text-red-600 transition-colors rounded-md"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</div>
                            <div x-show="portfolioAssets.length === 0" class="text-center p-12 text-text-secondary bg-bg-card rounded-2xl border border-border-color">
                                Sua carteira está vazia. Adicione uma transação para começar.
                            </div>
                        </div>

                        <div x-show="portfolioSubTab === 'crypto_assets'">
                            <h2 class="text-xl font-semibold text-text-primary mb-4">Meus Criptoativos</h2>
                            <div class="bg-bg-card rounded-2xl border border-border-color shadow-lg overflow-hidden">
                                <table class="w-full text-left">
                                    <thead class="border-b border-border-color text-sm">
                                        <tr class="text-left">
                                            <th class="p-4 font-semibold text-text-secondary">MOEDA</th>
                                            <th class="p-4 font-semibold text-text-secondary">COLD WALLET</th>
                                            <th class="p-4 font-semibold text-text-secondary text-right">QUANTIDADE</th>
                                            <th class="p-4 font-semibold text-text-secondary text-right" x-text="`PREÇO (${userSettings.currency === 'BRL' ? 'R$' : '$'})`"></th>
                                            <th class="p-4 font-semibold text-text-secondary text-right" x-text="`TOTAL (${userSettings.currency === 'BRL' ? 'R$' : '$'})`"></th>
                                            <th class="p-4 font-semibold text-text-secondary text-center">AÇÕES</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-if="cryptoAssets.length === 0">
                                            <tr>
                                                <td colspan="6" class="text-center p-12 text-text-secondary">Nenhuma cryptomoeda registrada.</td>
                                            </tr>
                                        </template>
                                        <template x-for="(asset, index) in cryptoAssets" :key="index">
                                            <tr class="border-t border-border-color text-sm text-text-primary" :class="{'flash-update': asset.justUpdated}">
                                                <td class="p-4 flex items-center gap-3">
                                                    <img :src="asset.logo" :alt="asset.name" class="w-6 h-6 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/32x32/777/fff?text=?';">
                                                    <div>
                                                        <div :class="{ 'font-bold': !asset.isCustom, 'font-medium': asset.isCustom }" x-text="asset.isCustom ? asset.name : asset.ticker"></div>
                                                    </div>
                                                </td>
                                                <td class="p-4" x-text="asset.coldwallet"></td>
                                                <td class="p-4 text-right" x-text="asset.qty"></td>
                                                <td class="p-4 text-right" x-text="formatCurrency(asset.coinPrice)"></td>
                                                <td class="p-4 text-right" x-text="formatCurrency(asset.totalValue)"></td>
                                                <td class="p-4 text-center">
                                                    <button @click="deleteCryptoAsset(index)" class="p-1 text-text-secondary hover:text-red-600 transition-colors rounded-md">
                                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div x-show="portfolioSubTab === 'profit-loss'">
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex-grow">
                                    <h2 class="text-xl font-semibold text-text-primary">Análise de Lucro e Prejuízo</h2>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-2"><label for="neutral-range" class="text-sm font-medium text-text-secondary">Faixa Neutra (%):</label><input type="number" id="neutral-range" x-model.number="plNeutralRange" class="w-20 p-2 form-input rounded-lg text-sm bg-bg-ui border-border-color text-text-primary"></div><button class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors text-sm">Exportar CSV</button>
                                </div>
                            </div>
                            <div class="bg-bg-card rounded-2xl border border-border-color shadow-lg overflow-hidden">
                                <table class="w-full text-left">
                                    <thead class="border-b border-border-color text-sm">
                                        <tr class="text-left">
                                            <th class="p-4 font-semibold text-text-secondary">ATIVO</th>
                                            <th class="p-4 font-semibold text-text-secondary">TICKER</th>
                                            <th class="p-4 font-semibold text-text-secondary text-right">QTD.</th>
                                            <th class="p-4 font-semibold text-text-secondary text-right">PREÇO MÉDIO</th>
                                            <th class="p-4 font-semibold text-text-secondary text-right">PREÇO ATUAL</th>
                                            <th class="p-4 font-semibold text-text-secondary text-right" x-text="`L/P (${userSettings.currency === 'BRL' ? 'R$' : '$'})`"></th>
                                            <th class="p-4 font-semibold text-text-secondary text-center">L/P (%)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-if="portfolioAssets.length === 0">
                                            <tr>
                                                <td colspan="7" class="text-center p-12 text-text-secondary">Nenhum ativo para analisar.</td>
                                            </tr>
                                        </template>
                                        <template x-for="asset in portfolioAssets" :key="asset.ticker">
                                            <tr class="border-t border-border-color text-sm text-text-primary">
                                                <td class="p-4 flex items-center gap-3">
                                                    <span 
 x-show="isAlertTriggered(asset)"                                                   
:class="getAlertIconStatus(asset)" @click="onClickAssetAlertIcon(asset.ticker)" x-html="getIcon(parseFloat(getVariationPercent(asset.currentPrice, asset.avgPrice)), true)">
                                                    </span>
                                                    <span x-text="asset.name"></span>
                                                </td>
                                                <td class="p-4" x-text="asset.ticker"></td>
                                                <td class="p-4 text-right" x-text="asset.qty"></td>
                                                <td class="p-4 text-right" x-text="formatCurrency(asset.avgPrice)"></td>
                                                <td class="p-4 text-right" x-text="formatCurrency(asset.currentPrice)"></td>
                                                <td class="p-4 text-right font-medium" :class="getPlColorClass(getVariationPercent(asset.currentPrice, asset.avgPrice))" x-text="formatCurrency((asset.currentPrice - asset.avgPrice) * asset.qty)"></td>
                                                <td class="p-4 text-center font-medium" :class="getPlColorClass(getVariationPercent(asset.currentPrice, asset.avgPrice))" x-text="`${getVariationPercent(asset.currentPrice, asset.avgPrice)}%`"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div x-show="portfolioSubTab === 'dividends'">
                            <h3 class="text-xl font-semibold text-text-primary mb-4">Resumo de Dividendos Recebidos</h3>
                            <div class="bg-bg-card rounded-2xl border border-border-color shadow-lg overflow-hidden mb-8">
                                <table class="w-full text-left">
                                    <thead class="border-b border-border-color text-sm">
                                        <tr>
                                            <th class="p-4 font-semibold text-text-secondary">TICKER</th>
                                            <th class="p-4 font-semibold text-text-secondary text-right">Total Bruto Recebido</th>
                                            <th class="p-4 font-semibold text-text-secondary text-right">Total Líquido Recebido</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="summary in dividendSummary" :key="summary.ticker">
                                            <tr class="border-t border-border-color text-sm text-text-primary">
                                                <td class="p-4 font-medium" x-text="summary.ticker"></td>
                                                <td class="p-4 text-right font-semibold text-brand-green" x-text="formatCurrency(summary.totalBruto)"></td>
                                                <td class="p-4 text-right font-semibold text-brand-green" x-text="formatCurrency(summary.totalLiquido)"></td>
                                            </tr>
                                        </template>
                                        <template x-if="dividendSummary.length === 0">
                                            <tr>
                                                <td colspan="3" class="text-center p-8 text-text-secondary">Nenhum dividendo registrado na aba de Imposto de Renda.</td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                            <div class="bg-bg-card p-6 rounded-2xl border border-border-color shadow-lg mt-8">
                                <h3 class="text-xl font-semibold text-text-primary mb-4">Projeção de Dividendos Futuros</h3>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead class="border-b border-border-color text-sm">
                                            <tr class="text-left">
                                                <th class="p-4 font-semibold text-text-secondary">TICKER</th>
                                                <th class="p-4 font-semibold text-text-secondary">FREQUÊNCIA</th>
                                                <th class="p-4 font-semibold text-text-secondary">DY (%) ANUAL</th>
                                                <th class="p-4 font-semibold text-text-secondary">PRÓX. DIA DIVIDENDO</th>
                                                <th class="p-4 font-semibold text-text-secondary text-right">PRÓX. DIV. RELATIVO ($)</th>
                                                <th class="p-4 font-semibold text-text-secondary text-center">AÇÕES</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-if="portfolioAssets.length === 0">
                                                <tr>
                                                    <td colspan="6" class="text-center p-12 text-text-secondary">Sua carteira está vazia.</td>
                                                </tr>
                                            </template>
                                            <template x-for="(asset, index) in portfolioAssets" :key="asset.ticker">
                                                <tr class="border-t border-border-color text-sm text-text-primary">
                                                    <td class="p-4 font-medium" x-text="asset.ticker"></td>
                                                    <td class="p-4">
                                                        <select x-model="asset.dividendFrequency" @change="saveDataDebounced()" class="form-select bg-bg-ui border-border-color text-text-primary rounded-lg p-2 text-sm w-full">
                                                            <option value="mensal">Mensal</option>
                                                            <option value="trimestral">Trimestral</option>
                                                            <option value="semestral">Semestral</option>
                                                            <option value="anual">Anual</option>
                                                            <option value="na">N/A</option>
                                                        </select>
                                                    </td>
                                                    <td class="p-4">
                                                        <input type="number" step="0.01" placeholder="Ex: 5.5" x-model.number="asset.dividendYield" @change="saveDataDebounced()" class="form-input bg-bg-ui border-border-color text-text-primary rounded-lg p-2 text-sm w-full">
                                                    </td>
                                                    <td class="p-4">
                                                        <input type="date" x-model="asset.nextDividendPayDate" @change="saveDataDebounced()" class="form-input bg-bg-ui border-border-color text-text-primary rounded-lg p-2 text-sm w-full">
                                                    </td>
                                                    <td class="p-4 text-right font-semibold text-brand-green" x-text="formatCurrency(calculateNextDividend(asset))"></td>
                                                    <td class="p-4 text-center">
                                                        <button @click="confirmDelete(asset.ticker)" class="p-1 text-text-secondary hover:text-red-600 transition-colors rounded-md">
                                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>

        <div x-show="mainTab === 'metas'">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-bg-card p-6 rounded-2xl border border-border-color shadow-lg">
                    <h3 class="text-xl font-semibold text-text-primary mb-6">Configurar Projeção</h3>
                    <div class="space-y-5">
                        <div>
                            <label for="proj-use-data" class="flex items-center space-x-3 cursor-pointer text-sm text-text-secondary hover:text-text-primary transition-colors">
                                <input type="checkbox" id="proj-use-data" x-model="projections.usePortfolioData" class="form-checkbox h-4 w-4 rounded bg-bg-ui border-border-color text-brand-cyan focus:ring-brand-cyan focus:ring-offset-bg-card">
                                <span>Usar valor atual do portfólio como base</span>
                            </label>
                        </div>
                        <div>
                            <label for="proj-valor-atual" class="block text-sm font-medium text-text-secondary mb-1">Valor Atual (BRL)</label>
                            <input type="number" step="any" id="proj-valor-atual" x-model.number="projections.valorAtualBRL" :disabled="projections.usePortfolioData" class="form-input w-full p-3 rounded-lg disabled:opacity-60" placeholder="Ex: 25000">
                        </div>
                        <div>
                            <label for="proj-valor-inicial" class="block text-sm font-medium text-text-secondary mb-1">Valor Inicial (BRL)</label>
                            <input type="number" step="any" id="proj-valor-inicial" x-model.number="projections.valorInicialBRL" class="form-input w-full p-3 rounded-lg" placeholder="Ex: 10000">
                        </div>
                        <div>
                            <label for="proj-meses" class="block text-sm font-medium text-text-secondary mb-1">Meses Desde o Valor Inicial</label>
                            <input type="number" id="proj-meses" x-model.number="projections.mesesDecorridos" class="form-input w-full p-3 rounded-lg" placeholder="Ex: 12">
                        </div>
                        <div>
                            <label for="proj-aporte" class="block text-sm font-medium text-text-secondary mb-1">Aporte Mensal (BRL)</label>
                            <input type="number" step="any" id="proj-aporte" x-model.number="projections.aporteMensalBRL" class="form-input w-full p-3 rounded-lg" placeholder="Ex: 500">
                        </div>
                        <div>
                            <label for="proj-meta" class="block text-sm font-medium text-text-secondary mb-1">Meta Financeira (BRL)</label>
                            <select id="proj-meta" x-model.number="projections.selectedGoal" class="form-select w-full p-3 rounded-lg">
                                <template x-for="goal in goals" :key="goal">
                                    <option :value="goal" x-text="new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(goal)"></option>
                                </template>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="bg-bg-card p-6 rounded-2xl border border-border-color shadow-lg">
                    <h3 class="text-xl font-semibold text-text-primary mb-6">Resultados da Projeção</h3>
                    <div x-show="!projections.results" class="text-center text-text-secondary py-12">
                        Preencha os campos para ver os resultados.
                    </div>
                    <div x-show="projections.results" class="space-y-8">
                        <div>
                            <h4 class="text-lg font-semibold text-brand-green mb-3">Em Reais (BRL)</h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between items-center"><span class="text-text-secondary">Rendimento Acumulado:</span> <span class="font-bold text-text-primary" x-text="(projections.results.reais.rendimentoAcumulado * 100).toFixed(2) + '%'"></span></div>
                                <div class="flex justify-between items-center"><span class="text-text-secondary">Taxa Média Mensal:</span> <span class="font-bold text-text-primary" x-text="(projections.results.reais.taxaMediaMensal * 100).toFixed(2) + '%'"></span></div>
                                <div class="flex justify-between items-center"><span class="text-text-secondary">Tempo Estimado para Meta:</span> <span class="font-bold text-text-primary" x-text="formatProjectionTime(projections.results.reais.mesesParaMeta)"></span></div>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-brand-blue mb-3">Em Dólares (USD)</h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between items-center"><span class="text-text-secondary">Rendimento Acumulado:</span> <span class="font-bold text-text-primary" x-text="(projections.results.dolares.rendimentoAcumulado * 100).toFixed(2) + '%'"></span></div>
                                <div class="flex justify-between items-center"><span class="text-text-secondary">Taxa Média Mensal:</span> <span class="font-bold text-text-primary" x-text="(projections.results.dolares.taxaMediaMensal * 100).toFixed(2) + '%'"></span></div>
                                <div class="flex justify-between items-center"><span class="text-text-secondary">Tempo Estimado para Meta:</span> <span class="font-bold text-text-primary" x-text="formatProjectionTime(projections.results.dolares.mesesParaMeta)"></span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div x-show="mainTab === 'ir'">
                    <div class="bg-bg-card p-6 rounded-2xl border border-border-color shadow-lg overflow-hidden">
                        <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                            <div id="ir-report-type" class="flex flex-wrap gap-2">
                                <div class="relative"><input type="radio" id="ir-saldos" value="saldos" class="sr-only peer" x-model="irTab"><label for="ir-saldos" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-blue peer-checked:border-brand-blue">Saldos 31/12</label></div>
                                <div class="relative"><input type="radio" id="ir-aportes" value="aportes" class="sr-only peer" x-model="irTab"><label for="ir-aportes" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-blue peer-checked:border-brand-blue">Aportes/Retiradas</label></div>
                                <div class="relative"><input type="radio" id="ir-compras" value="comprasVendas" class="sr-only peer" x-model="irTab"><label for="ir-compras" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-blue peer-checked:border-brand-blue">Compra/Venda</label></div>
                                <div class="relative"><input type="radio" id="ir-proventos" value="proventos" class="sr-only peer" x-model="irTab"><label for="ir-proventos" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-blue peer-checked:border-brand-blue">Proventos</label></div>
                                <div class="relative"><input type="radio" id="ir-remessas" value="remessas" class="sr-only peer" x-model="irTab"><label for="ir-remessas" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-blue peer-checked:border-brand-blue">Remessas</label></div>
                            </div>
                            <button @click="exportIrToCsv()" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors text-sm">Exportar CSV</button>
                        </div>
                        <div x-show="irTab === 'saldos'">
                            <h3 class="text-xl font-semibold mb-4 text-text-primary">Saldos em 31 de dezembro</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="text-left border-b border-border-color">
                                            <th class="p-3 font-medium text-text-secondary">Tipo de Conta</th>
                                            <th class="p-3 font-medium text-text-secondary">Instituição</th>
                                            <th class="p-3 font-medium text-text-secondary">Saldo (USD)</th>
                                            <th class="p-3 font-medium text-text-secondary">Cotação USD</th>
                                            <th class="p-3 font-medium text-text-secondary">Saldo (BRL)</th>
                                            <th class="p-3 font-medium text-text-secondary">Observações</th>
                                            <th class="w-10"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(item, index) in irData.saldos">
                                            <tr class="border-b border-border-color">
                                                <td contenteditable="true" @blur="item.tipoConta = $event.target.innerText; saveDataDebounced()" x-text="item.tipoConta" class="p-2 text-text-primary" :class="{'needs-input' : !item.tipoConta}"></td>
                                                <td contenteditable="true" @blur="item.instituicao = $event.target.innerText; saveDataDebounced()" x-text="item.instituicao" class="p-2 text-text-primary" :class="{'needs-input' : !item.instituicao}"></td>
                                                <td contenteditable="true" @blur="item.saldoUSD = $event.target.innerText; saveDataDebounced()" x-text="item.saldoUSD" class="p-2 text-text-primary" :class="{'needs-input' : !item.saldoUSD}"></td>
                                                <td contenteditable="true" @blur="item.cotacao = $event.target.innerText; saveDataDebounced()" x-text="item.cotacao" class="p-2 text-text-primary" :class="{'needs-input' : !item.cotacao}"></td>
                                                <td contenteditable="true" @blur="item.saldoBRL = $event.target.innerText; saveDataDebounced()" x-text="item.saldoBRL" class="p-2 text-text-primary" :class="{'needs-input' : !item.saldoBRL}"></td>
                                                <td contenteditable="true" @blur="item.obs = $event.target.innerText; saveDataDebounced()" x-text="item.obs" class="p-2 text-text-primary"></td>
                                                <td class="text-center"><button @click="deleteIrRow('saldos', index)" class="p-1 text-text-secondary hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                                        </svg></button></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="7" class="pt-4"><button @click="addIrRow('saldos')" class="text-brand-cyan font-semibold text-sm hover:text-brand-cyan/80">+ Adicionar Linha</button></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        <div x-show="irTab === 'aportes'">
                            <h3 class="text-xl font-semibold mb-4 text-text-primary">Aportes e Retiradas</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="text-left border-b border-border-color">
                                            <th class="p-3 font-medium text-text-secondary">Data</th>
                                            <th class="p-3 font-medium text-text-secondary">Tipo</th>
                                            <th class="p-3 font-medium text-text-secondary">Valor (BRL)</th>
                                            <th class="p-3 font-medium text-text-secondary">Cotação USD</th>
                                            <th class="p-3 font-medium text-text-secondary">Valor (USD)</th>
                                            <th class="p-3 font-medium text-text-secondary">Instituição</th>
                                            <th class="p-3 font-medium text-text-secondary">Observações</th>
                                            <th class="w-10"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(item, index) in irData.aportes">
                                            <tr class="border-b border-border-color">
                                                <td contenteditable="true" @blur="item.data = $event.target.innerText; saveDataDebounced()" x-text="item.data" class="p-2 text-text-primary" :class="{'needs-input' : !item.data}"></td>
                                                <td contenteditable="true" @blur="item.tipo = $event.target.innerText; saveDataDebounced()" x-text="item.tipo" class="p-2 text-text-primary" :class="{'needs-input' : !item.tipo}"></td>
                                                <td contenteditable="true" @blur="item.valorBRL = $event.target.innerText; saveDataDebounced()" x-text="item.valorBRL" class="p-2 text-text-primary" :class="{'needs-input' : !item.valorBRL}"></td>
                                                <td contenteditable="true" @blur="item.cotacao = $event.target.innerText; saveDataDebounced()" x-text="item.cotacao" class="p-2 text-text-primary" :class="{'needs-input' : !item.cotacao}"></td>
                                                <td contenteditable="true" @blur="item.valorUSD = $event.target.innerText; saveDataDebounced()" x-text="item.valorUSD" class="p-2 text-text-primary" :class="{'needs-input' : !item.valorUSD}"></td>
                                                <td contenteditable="true" @blur="item.instituicao = $event.target.innerText; saveDataDebounced()" x-text="item.instituicao" class="p-2 text-text-primary" :class="{'needs-input' : !item.instituicao}"></td>
                                                <td contenteditable="true" @blur="item.obs = $event.target.innerText; saveDataDebounced()" x-text="item.obs" class="p-2 text-text-primary"></td>
                                                <td class="text-center"><button @click="deleteIrRow('aportes', index)" class="p-1 text-text-secondary hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                                        </svg></button></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="8" class="pt-4"><button @click="addIrRow('aportes')" class="text-brand-cyan font-semibold text-sm hover:text-brand-cyan/80">+ Adicionar Linha</button></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        <div x-show="irTab === 'comprasVendas'">
                            <h3 class="text-xl font-semibold mb-4 text-text-primary">Compra e Venda</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="text-left border-b border-border-color">
                                            <th class="p-3 font-medium text-text-secondary">Data</th>
                                            <th class="p-3 font-medium text-text-secondary">Tipo</th>
                                            <th class="p-3 font-medium text-text-secondary">Ticker</th>
                                            <th class="p-3 font-medium text-text-secondary">Ativo</th>
                                            <th class="p-3 font-medium text-text-secondary">Qtd</th>
                                            <th class="p-3 font-medium text-text-secondary">Preço/Unid.</th>
                                            <th class="p-3 font-medium text-text-secondary">Total USD</th>
                                            <th class="p-3 font-medium text-text-secondary">Corretora</th>
                                            <th class="p-3 font-medium text-text-secondary">Obs.</th>
                                            <th class="w-10"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(item, index) in irData.comprasVendas">
                                            <tr class="border-b border-border-color">
                                                <td contenteditable="true" @blur="item.data = $event.target.innerText; saveDataDebounced()" x-text="item.data" class="p-2 text-text-primary" :class="{'needs-input' : !item.data}"></td>
                                                <td contenteditable="true" @blur="item.tipo = $event.target.innerText; saveDataDebounced()" x-text="item.tipo" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.ticker = $event.target.innerText; saveDataDebounced()" x-text="item.ticker" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.ativo = $event.target.innerText; saveDataDebounced()" x-text="item.ativo" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.qtd = $event.target.innerText; saveDataDebounced()" x-text="item.qtd" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.preco = $event.target.innerText; saveDataDebounced()" x-text="item.preco" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.total = $event.target.innerText; saveDataDebounced()" x-text="item.total" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.corretora = $event.target.innerText; saveDataDebounced()" x-text="item.corretora" class="p-2 text-text-primary" :class="{'needs-input' : !item.corretora}"></td>
                                                <td contenteditable="true" @blur="item.obs = $event.target.innerText; saveDataDebounced()" x-text="item.obs" class="p-2 text-text-primary"></td>
                                                <td class="text-center"><button @click="deleteIrRow('comprasVendas', index)" class="p-1 text-text-secondary hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                                        </svg></button></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="10" class="pt-4"><button @click="addIrRow('comprasVendas')" class="text-brand-cyan font-semibold text-sm hover:text-brand-cyan/80">+ Adicionar Linha</button></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        <div x-show="irTab === 'proventos'">
                            <h3 class="text-xl font-semibold mb-4 text-text-primary">Proventos</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="text-left border-b border-border-color">
                                            <th class="p-3 font-medium text-text-secondary">Data</th>
                                            <th class="p-3 font-medium text-text-secondary">Ticker</th>
                                            <th class="p-3 font-medium text-text-secondary">Ativo</th>
                                            <th class="p-3 font-medium text-text-secondary">Tipo Provento</th>
                                            <th class="p-3 font-medium text-text-secondary">Valor Bruto</th>
                                            <th class="p-3 font-medium text-text-secondary">Imposto Retido</th>
                                            <th class="p-3 font-medium text-text-secondary">Valor Líquido</th>
                                            <th class="p-3 font-medium text-text-secondary">Observações</th>
                                            <th class="w-10"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(item, index) in irData.proventos">
                                            <tr class="border-b border-border-color">
                                                <td contenteditable="true" @blur="item.data = $event.target.innerText; saveDataDebounced()" x-text="item.data" class="p-2 text-text-primary" :class="{'needs-input' : !item.data}"></td>
                                                <td contenteditable="true" @blur="item.ticker = $event.target.innerText; saveDataDebounced()" x-text="item.ticker" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.ativo = $event.target.innerText; saveDataDebounced()" x-text="item.ativo" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.tipo = $event.target.innerText; saveDataDebounced()" x-text="item.tipo" class="p-2 text-text-primary" :class="{'needs-input' : !item.tipo}"></td>
                                                <td contenteditable="true" @blur="item.bruto = $event.target.innerText; saveDataDebounced()" x-text="item.bruto" class="p-2 text-text-primary" :class="{'needs-input' : !item.bruto}"></td>
                                                <td contenteditable="true" @blur="item.imposto = $event.target.innerText; saveDataDebounced()" x-text="item.imposto" class="p-2 text-text-primary" :class="{'needs-input' : !item.imposto}"></td>
                                                <td contenteditable="true" @blur="item.liquido = $event.target.innerText; saveDataDebounced()" x-text="item.liquido" class="p-2 text-text-primary"></td>
                                                <td contenteditable="true" @blur="item.obs = $event.target.innerText; saveDataDebounced()" x-text="item.obs" class="p-2 text-text-primary"></td>
                                                <td class="text-center"><button @click="deleteIrRow('proventos', index)" class="p-1 text-text-secondary hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                                        </svg></button></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="9" class="pt-4"><button @click="addIrRow('proventos')" class="text-brand-cyan font-semibold text-sm hover:text-brand-cyan/80">+ Adicionar Linha</button></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        <div x-show="irTab === 'remessas'">
                            <h3 class="text-xl font-semibold mb-4 text-text-primary">Remessas</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="text-left border-b border-border-color">
                                            <th class="p-3 font-medium text-text-secondary">Data</th>
                                            <th class="p-3 font-medium text-text-secondary">Valor (BRL)</th>
                                            <th class="p-3 font-medium text-text-secondary">Cotação USD</th>
                                            <th class="p-3 font-medium text-text-secondary">Valor (USD)</th>
                                            <th class="p-3 font-medium text-text-secondary">Destino</th>
                                            <th class="p-3 font-medium text-text-secondary">Observações</th>
                                            <th class="w-10"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(item, index) in irData.remessas">
                                            <tr class="border-b border-border-color">
                                                <td contenteditable="true" @blur="item.data = $event.target.innerText; saveDataDebounced()" x-text="item.data" class="p-2 text-text-primary" :class="{'needs-input' : !item.data}"></td>
                                                <td contenteditable="true" @blur="item.valorBRL = $event.target.innerText; saveDataDebounced()" x-text="item.valorBRL" class="p-2 text-text-primary" :class="{'needs-input' : !item.valorBRL}"></td>
                                                <td contenteditable="true" @blur="item.cotacao = $event.target.innerText; saveDataDebounced()" x-text="item.cotacao" class="p-2 text-text-primary" :class="{'needs-input' : !item.cotacao}"></td>
                                                <td contenteditable="true" @blur="item.valorUSD = $event.target.innerText; saveDataDebounced()" x-text="item.valorUSD" class="p-2 text-text-primary" :class="{'needs-input' : !item.valorUSD}"></td>
                                                <td contenteditable="true" @blur="item.destino = $event.target.innerText; saveDataDebounced()" x-text="item.destino" class="p-2 text-text-primary" :class="{'needs-input' : !item.destino}"></td>
                                                <td contenteditable="true" @blur="item.obs = $event.target.innerText; saveDataDebounced()" x-text="item.obs" class="p-2 text-text-primary"></td>
                                                <td class="text-center"><button @click="deleteIrRow('remessas', index)" class="p-1 text-text-secondary hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                                        </svg></button></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="7" class="pt-4"><button @click="addIrRow('remessas')" class="text-brand-cyan font-semibold text-sm hover:text-brand-cyan/80">+ Adicionar Linha</button></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div x-show="mainTab === 'automation'">
                    <div class="bg-bg-card p-6 rounded-2xl border border-border-color shadow-lg">
                        <h2 class="text-xl font-semibold text-text-primary mb-4">Automação da Carteira (Premium)</h2>
                        <p class="text-text-secondary">Esta seção utilizará a integração com o Plaid para sincronizar automaticamente suas transações, posições e dividendos diretamente da sua corretora.</p>
                        <p class="text-text-secondary mt-2">É uma funcionalidade premium que estará disponível em breve.</p>
                    </div>
                </div>

              <div x-show="mainTab === 'config'">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

        <div class="bg-bg-card p-6 rounded-2xl border border-border-color shadow-lg">
            <div class="space-y-6">
                <div>
                    <label for="user-name" class="block text-sm font-medium text-text-secondary mb-1">Nome</label>
                    <input type="text" id="user-name" x-model="tempUserSettings.name" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                </div>
                <div>
                    <label for="user-username" class="block text-sm font-medium text-text-secondary mb-1">Usuário</label>
                    <input type="text" id="user-username" x-model="tempUserSettings.username" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                </div>
                <div>
                    <label for="update-date" class="block text-sm font-medium text-text-secondary mb-1">Lembrete de Atualização da Carteira</label>
                    <input type="date" id="update-date" x-model="tempUserSettings.updateReminderDate" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Moeda Padrão</label>
                    <div class="flex flex-wrap gap-2">
                        <div class="relative"><input type="radio" id="currency-usd" value="USD" class="sr-only peer" x-model="tempUserSettings.currency"><label for="currency-usd" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-blue peer-checked:border-brand-blue">USD ($)</label></div>
                        <div class="relative"><input type="radio" id="currency-brl" value="BRL" class="sr-only peer" x-model="tempUserSettings.currency"><label for="currency-brl" class="block px-4 py-2 rounded-lg cursor-pointer text-sm font-semibold border bg-bg-ui border-border-color transition-colors peer-checked:bg-bg-card peer-checked:text-brand-green peer-checked:border-brand-green">BRL (R$)</label></div>
                    </div>
                </div>
                <div x-show="tempUserSettings.currency === 'BRL'">
                    <label for="exchange-rate-config" class="block text-sm font-medium text-text-secondary mb-1">Cotação do Dólar (USD para BRL)</label>
                    <input type="number" step="0.01" id="exchange-rate-config" x-model.number="userSettings.exchangeRate" @input="saveDataDebounced()" class="form-input w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                </div>
                <div>
                    <label for="auto-refresh-interval" class="block text-sm font-medium text-text-secondary mb-1">Atualização Automática (Resumo)</label>
                    <select id="auto-refresh-interval" x-model="tempUserSettings.autoRefreshInterval" class="form-select w-full p-3 rounded-lg bg-bg-ui border-border-color text-text-primary">
                        <option value="manual">Manual</option>
                        <option value="5">A cada 5 minutos</option>
                        <option value="15">A cada 15 minutos</option>
                        <option value="60">A cada 1 hora</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Tema</label>
                    <div class="flex flex-wrap gap-2">
                        <button @click="setTheme('theme-dark')" :class="{'bg-brand-cyan text-white': userSettings.theme === 'theme-dark', 'bg-bg-ui text-text-primary': userSettings.theme !== 'theme-dark'}" class="px-4 py-2 rounded-lg text-sm font-semibold border border-border-color transition-colors">Dark</button>
                        <button @click="setTheme('theme-ocean')" :class="{'bg-brand-cyan text-white': userSettings.theme === 'theme-ocean', 'bg-bg-ui text-text-primary': userSettings.theme !== 'theme-ocean'}" class="px-4 py-2 rounded-lg text-sm font-semibold border border-border-color transition-colors">Ocean</button>
                        <button @click="setTheme('theme-office')" :class="{'bg-brand-cyan text-white': userSettings.theme === 'theme-office', 'bg-bg-ui text-text-primary': userSettings.theme !== 'theme-office'}" class="px-4 py-2 rounded-lg text-sm font-semibold border border-border-color transition-colors">Office</button>
                        <button @click="setTheme('theme-nightlife')" :class="{'bg-brand-cyan text-white': userSettings.theme === 'theme-nightlife', 'bg-bg-ui text-text-primary': userSettings.theme !== 'theme-nightlife'}" class="px-4 py-2 rounded-lg text-sm font-semibold border border-border-color transition-colors">Night Life</button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Configurações da Calculadora</label>
                    <div class="p-4 rounded-lg bg-bg-ui border border-border-color space-y-6">
                        <div>
                            <label for="opacity-slider" class="block text-sm text-text-primary mb-2">Transparência: <span class="font-bold text-brand-cyan" x-text="`${calculatorSettings.opacity}%`"></span></label>
                            <input id="opacity-slider" type="range" min="10" max="100" step="1" x-model.number="calculatorSettings.opacity" class="w-full h-2 bg-border-color rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div>
                            <label class="block text-sm text-text-primary mb-2">Tamanho da Fonte</label>
                            <div class="flex flex-wrap gap-2">
                                <div class="relative"><input type="radio" id="font-grande" value="text-2xl" class="sr-only peer" x-model="calculatorSettings.fontSize"><label for="font-grande" class="block px-3 py-1.5 rounded-lg cursor-pointer text-xs font-semibold border bg-bg-card border-border-color transition-colors peer-checked:text-brand-cyan peer-checked:border-brand-cyan">Grande</label></div>
                                <div class="relative"><input type="radio" id="font-media" value="text-xl" class="sr-only peer" x-model="calculatorSettings.fontSize"><label for="font-media" class="block px-3 py-1.5 rounded-lg cursor-pointer text-xs font-semibold border bg-bg-card border-border-color transition-colors peer-checked:text-brand-cyan peer-checked:border-brand-cyan">Média</label></div>
                                <div class="relative"><input type="radio" id="font-pequena" value="text-base" class="sr-only peer" x-model="calculatorSettings.fontSize"><label for="font-pequena" class="block px-3 py-1.5 rounded-lg cursor-pointer text-xs font-semibold border bg-bg-card border-border-color transition-colors peer-checked:text-brand-cyan peer-checked:border-brand-cyan">Pequena</label></div>
                                <div class="relative"><input type="radio" id="font-minima" value="text-sm" class="sr-only peer" x-model="calculatorSettings.fontSize"><label for="font-minima" class="block px-3 py-1.5 rounded-lg cursor-pointer text-xs font-semibold border bg-bg-card border-border-color transition-colors peer-checked:text-brand-cyan peer-checked:border-brand-cyan">Mínima</label></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-t border-border-color mt-6 pt-6 space-y-4">
                <div class="flex justify-between items-center gap-4">
                    <button @click="saveSettings()" class="flex-1 bg-brand-cyan text-white dark:text-bg-sidebar font-semibold p-3 rounded-lg shadow-sm hover:opacity-90 transition-opacity">Salvar Alterações</button>
                    <button @click="logout()" class="flex-1 bg-bg-ui border border-border-color text-text-primary font-semibold p-3 rounded-lg shadow-sm hover:border-brand-orange transition-colors">Sair</button>
                </div>
                <div class="border-t border-red-500/30 pt-4">
                    <button @click="showResetConfirmation = true" class="w-full bg-red-600/90 text-white font-semibold p-3 rounded-lg shadow-sm hover:bg-red-600 transition-colors">Resetar Carteira</button>
                    <p class="text-xs text-text-secondary mt-2 text-center">Atenção: Esta ação apagará permanentemente todos os dados da sua carteira.</p>
                </div>
            </div>
        </div>

        <div class="bg-bg-card p-4 rounded-2xl border border-border-color shadow-lg space-y-4">
    <div @click="window.open('https://www.google.com/search?q=horario+funcionamento+bolsa+americana', '_blank')" class="bg-bg-ui p-4 rounded-2xl border border-border-color flex justify-between items-center cursor-pointer hover:border-brand-purple transition-colors">
        <div>
            <p class="font-bold text-text-primary">NYSE & NASDAQ</p>
            <p class="text-xs text-text-secondary -mt-1">Horário de Funcionamento</p>
            <p class="text-xl font-bold text-text-primary mt-2" x-text="marketHoursBRT"></p>
        </div>
        <div class="w-10 h-10 rounded-full bg-brand-purple/20 flex items-center justify-center">
            <i data-lucide="clock" class="w-5 h-5 text-brand-purple"></i>
        </div>
    </div>

    <template x-for="index in Object.values(marketIndices)" :key="index.ticker">
        <div @click="index.ticker === 'DVOL' 
            ? window.open('https://www.tradingview.com/symbols/DVOL/', '_blank') 
            : window.open(`https://www.google.com/search?q=${encodeURIComponent(index.name)}+index`, '_blank')"
            class="bg-bg-ui p-4 rounded-2xl border border-border-color flex justify-between items-center cursor-pointer transition-colors"
            :class="{
                'hover:border-brand-cyan': !['VIX', 'DVOL'].includes(index.ticker),
                [getVixColorClass(index.price)]: index.ticker === 'VIX',
                [getDvolColorClass(index.price)]: index.ticker === 'DVOL'
            }">
            <div>
                <p class="font-bold text-text-primary" x-text="index.name"></p>
                <p class="text-xs text-text-secondary -mt-1">Índice</p>
                <p class="text-xl font-bold text-text-primary mt-2" x-text="index.price > 0 ? index.price.toFixed(2) : 'Carregando...'"></p>
                
                <p x-show="!['VIX', 'DVOL'].includes(index.ticker)" 
                   class="text-sm font-semibold mt-1" 
                   :class="index.change >= 0 ? 'text-brand-green' : 'text-brand-orange'" 
                   x-text="index.change > 0 ? `+${index.change.toFixed(2)}%` : `${index.change.toFixed(2)}%`"></p>
            </div>
            
            <div x-show="!['VIX', 'DVOL'].includes(index.ticker)" x-html="getIndexIcon(index.ticker)"></div>
        </div>
    </template>
</div>
    </div>
</div>
        </main>
    </div>

    <div x-show="isModalOpen || isAlertModalOpen || showResetConfirmation || showUndoConfirmation || infoPopup.show" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-70" x-cloak>
        <div x-show="isModalOpen" @click.away="isModalOpen = false" x-transition class="bg-bg-card rounded-2xl shadow-xl max-w-2xl w-full mx-auto p-6 border border-border-color">
            <h3 class="text-xl font-semibold text-text-primary mb-4">Análise da Carteira com IA</h3>
            <div x-show="isLoadingAnalysis" class="flex flex-col items-center justify-center h-48">
                <div class="w-10 h-10 border-4 border-brand-cyan border-t-transparent rounded-full animate-spin"></div>
                <p class="mt-4 text-text-secondary">Analisando... Isso pode levar alguns segundos.</p>
            </div>
            <div x-show="!isLoadingAnalysis" class="prose prose-invert max-w-none text-text-primary" x-html="analysisResult"></div>
        </div>

        <div x-show="isAlertModalOpen" @click.away="isAlertModalOpen = false" x-transition class="bg-bg-card rounded-2xl shadow-xl max-w-md w-full mx-auto p-6 border border-border-color">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-text-primary">Definir Alerta de Venda</h3>
                <button @click="isAlertModalOpen = false" class="text-text-secondary hover:text-text-primary transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="space-y-4 mb-6">
                <div>
                    <label for="alert-asset" class="block text-sm font-medium text-text-secondary mb-1">Ativo</label>
                    <select id="alert-asset" x-model="alertConfig.ticker" @change="loadAlertSettingsForTicker()" class="form-select w-full p-2 rounded-lg bg-bg-ui border-border-color text-text-primary">
                        <option value="">-- Selecione um Ativo --</option>
                        <template x-for="a in portfolioAssets" :key="a.ticker">
                            <option :value="a.ticker" x-text="a.ticker"></option>
                        </template>
                    </select>
                </div>
                <div>
                    <label for="alert-periodo" class="block text-sm font-medium text-text-secondary mb-1">Período de Análise (para ambos)</label>
                    <select id="alert-periodo" x-model="alertConfig.period" class="form-select w-full p-2 rounded-lg bg-bg-ui border-border-color text-text-primary">
                        <option value="dia">No Dia</option>
                        <option value="mes">No Mês</option>
                        <option value="bimestre">No Bimestre</option>
                        <option value="trimestre">No Trimestre</option>
                        <option value="semestre">No Semestre</option>
                        <option value="ano">No Ano</option>
                        <option value="inicio">Desde o Início</option>
                    </select>
                </div>
            </div>
            <div class="border-t border-border-color pt-4 space-y-4">
                <div>
                    <label for="alert-valorizar" class="block text-sm font-medium text-text-secondary mb-1">Valorizar em %</label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-grow">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><i data-lucide="trending-up" class="w-5 h-5 text-brand-green"></i></span>
                            <input type="number" step="any" id="alert-valorizar" x-model.number="alertConfig.valorizarPercent" class="form-input w-full p-2 pl-10 rounded-lg bg-bg-ui border-border-color text-text-primary" placeholder="Nenhum">
                        </div>
                        <button @click.prevent="saveIndividualAlert('valorizar')" class="px-4 py-2 rounded-lg bg-brand-orange text-white font-semibold hover:opacity-90 transition-opacity text-sm">Salvar</button>
                    </div>
                </div>
                <div>
                    <label for="alert-desvalorizar" class="block text-sm font-medium text-text-secondary mb-1">Desvalorizar em %</label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-grow">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><i data-lucide="trending-down" class="w-5 h-5 text-brand-orange"></i></span>
                            <input type="number" step="any" id="alert-desvalorizar" x-model.number="alertConfig.desvalorizarPercent" class="form-input w-full p-2 pl-10 rounded-lg bg-bg-ui border-border-color text-text-primary" placeholder="Nenhum">
                        </div>
                        <button @click.prevent="saveIndividualAlert('desvalorizar')" class="px-4 py-2 rounded-lg bg-brand-orange text-white font-semibold hover:opacity-90 transition-opacity text-sm">Salvar</button>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="showResetConfirmation" @click.away="showResetConfirmation = false" x-transition class="bg-bg-card rounded-2xl shadow-xl max-w-sm w-full mx-auto p-6 border border-red-500/50">
            <h3 class="text-xl font-semibold text-red-400 mb-4">Confirmar Reset</h3>
            <p class="text-text-secondary mb-6">Tem certeza que deseja apagar TODOS os dados da sua carteira? Esta ação não pode ser desfeita.</p>
            <div class="flex justify-end gap-4">
                <button @click="showResetConfirmation = false" class="px-4 py-2 rounded-lg bg-bg-ui text-text-primary font-semibold hover:bg-border-color transition-colors">Cancelar</button>
                <button @click="resetPortfolio()" class="px-4 py-2 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors">Sim, Resetar</button>
            </div>
        </div>
        
        <div x-show="showUndoConfirmation" @click.away="showUndoConfirmation = false" x-transition class="bg-bg-card rounded-2xl shadow-xl max-w-sm w-full mx-auto p-6 border border-border-color">
            <h3 class="text-xl font-semibold text-brand-yellow mb-4">Desfazer Última Ação</h3>
            <p class="text-text-secondary mb-6">Deseja desfazer a última alteração (<span class="font-semibold" x-text="history.length > 0 ? history[history.length - 1].description : ''"></span>)?</p>
            <div class="flex justify-end gap-4">
                <button @click="showUndoConfirmation = false" class="px-4 py-2 rounded-lg bg-bg-ui text-text-primary font-semibold hover:bg-border-color transition-colors">Cancelar</button>
                <button @click="undoLastAction()" class="px-4 py-2 rounded-lg bg-brand-yellow text-black font-semibold hover:opacity-90 transition-opacity">Sim, Desfazer</button>
            </div>
        </div>

        <div x-show="infoPopup.show" @click.away="infoPopup.show = false" x-transition class="bg-bg-card rounded-2xl shadow-xl max-w-sm w-full mx-auto p-6 border border-brand-cyan">
             <h3 class="text-xl font-semibold text-brand-cyan mb-4" x-text="infoPopup.title"></h3>
            <p class="text-text-secondary mb-6" x-text="infoPopup.content"></p>
            <div class="flex justify-end">
                <button @click="infoPopup.show = false" class="px-4 py-2 rounded-lg bg-bg-ui text-text-primary font-semibold hover:bg-border-color transition-colors">Entendi</button>
            </div>
        </div>
    </div>
    
    <div x-show="showCalculatorModal" class="fixed inset-0 z-[60] pointer-events-none" x-cloak>
        <div 
             x-transition 
             class="draggable-modal bg-transparent shadow-xl pointer-events-auto flex flex-col" 
             @mousedown.prevent="calculator.handleMouseDown($event)"
             :style="{
                 'opacity': calculatorSettings.opacity / 100, 
                 'position': 'absolute',
                 'left': calculator.x ? `${calculator.x}px` : `calc(100vw - 326px)`,
                 'top': calculator.y ? `${calculator.y}px` : '120px',
                 'width': calculator.isMinimized ? 'auto' : '276px',
                 'height': 'auto',
                 'transform': `scale(${calculator.scale})`
             }">
            
            <div x-show="calculator.showMemory"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-x-[-20px]"
                 x-transition:enter-end="opacity-100 translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-x-0"
                 x-transition:leave-end="opacity-0 translate-x-[-20px]"
                 class="memory-panel">
                 <template x-if="calculator.memoryHistory.length === 0">
                    <p class="text-center text-sm text-expression-color mt-4">A memória está vazia.</p>
                 </template>
                 <template x-for="(item, index) in calculator.memoryHistory" :key="index">
                    <div class="memory-item">
                        <div class="memory-item-expression" x-text="item.expression"></div>
                        <div class="memory-item-result" x-text="item.result"></div>
                    </div>
                 </template>
            </div>
            
            <div class="calculator-container" x-show="!calculator.isMinimized">
                <div class="window-controls">
                    <div @click.stop="calculator.toggleMinimize()" class="control-btn">-</div>
                    <div @click.stop="showCalculatorModal = false" class="control-btn">×</div>
                </div>
                <div class="header draggable-header">
                    <h1>Calculadora</h1>
                </div>
                <div class="display" :class="calculatorSettings.fontSize">
                    <div class="expression" x-html="calculator.expression || '&nbsp;'"></div>
                    <div class="result" x-text="calculator.display"></div>
                </div>
                <div class="keypad">
                    <button @click="calculator.handleAction('clear')" class="btn btn-top-row">AC</button>
                    <button @click="calculator.handleAction('memory')" class="btn btn-top-row" :class="{'text-brand-cyan': calculator.showMemory}">M</button>
                    <button @click="calculator.handleAction('backspace')" class="btn btn-top-row">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path><line x1="18" y1="9" x2="12" y2="15"></line><line x1="12" y1="9" x2="18" y2="15"></line></svg>
                    </button>
                    <button @click="calculator.handleAction('percent')" class="btn btn-operator">%</button>
                    <button @click="calculator.appendNumber('7')" class="btn">7</button>
                    <button @click="calculator.appendNumber('8')" class="btn">8</button>
                    <button @click="calculator.appendNumber('9')" class="btn">9</button>
                    <button @click="calculator.chooseOperation('/')" class="btn btn-operator">÷</button>
                    <button @click="calculator.appendNumber('4')" class="btn">4</button>
                    <button @click="calculator.appendNumber('5')" class="btn">5</button>
                    <button @click="calculator.appendNumber('6')" class="btn">6</button>
                    <button @click="calculator.chooseOperation('*')" class="btn btn-operator">x</button>
                    <button @click="calculator.appendNumber('1')" class="btn">1</button>
                    <button @click="calculator.appendNumber('2')" class="btn">2</button>
                    <button @click="calculator.appendNumber('3')" class="btn">3</button>
                    <button @click="calculator.chooseOperation('-')" class="btn btn-operator">-</button>
                    <button @click="calculator.appendNumber('0')" class="btn">0</button>
                    <button @click="calculator.handleAction('decimal')" class="btn">.</button>
                    <button @click="calculator.handleAction('calculate')" class="btn btn-equals">=</button>
                    <button @click="calculator.chooseOperation('+')" class="btn btn-operator">+</button>
                </div>
            </div>

            <div class="calculator-minimized draggable-header" x-show="calculator.isMinimized">
                <h1>Calculadora</h1>
                <div class="window-controls">
                    <div @click.stop="calculator.toggleMinimize()" class="control-btn" style="transform: translateY(-1px);">+</div>
                    <div @click.stop="showCalculatorModal = false" class="control-btn">×</div>
                </div>
            </div>

            <div class="resize-handle-tl"></div>
            <div class="resize-handle-tr"></div>
            <div class="resize-handle-bl"></div>
            <div class="resize-handle-br"></div>
        </div>
    </div>

        <div class="resize-handle-tl" @mousedown.prevent.stop="calculator.startResize($event)"></div>
        <div class="resize-handle-tr" @mousedown.prevent.stop="calculator.startResize($event)"></div>
        <div class="resize-handle-bl" @mousedown.prevent.stop="calculator.startResize($event)"></div>
        <div class="resize-handle-br" @mousedown.prevent.stop="calculator.startResize($event)"></div>
    </div>
</div>
    
    <script src="script.js"></script>

</body>

</html>